<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grupo Armindo Art Museum</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0e27;
            color: #fff;
            overflow-x: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 30px rgba(102, 126, 234, 0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .user-photo {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            object-fit: cover;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 0.8rem 1.8rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(5px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1f3a 0%, #2d1b3d 100%);
            padding: 3rem;
            border-radius: 20px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-content h2 {
            margin-bottom: 2rem;
            text-align: center;
            font-size: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .form-group {
            margin: 1.5rem 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #b8b8d1;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 1rem;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 1rem;
            transition: all 0.3s;
            font-family: inherit;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255, 255, 255, 0.1);
        }

        .google-btn {
            background: white;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;
            width: 100%;
            padding: 1rem;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 1rem;
            transition: all 0.3s;
        }

        .google-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }

        .divider {
            text-align: center;
            margin: 1.5rem 0;
            color: #b8b8d1;
            position: relative;
        }

        .divider::before,
        .divider::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 40%;
            height: 1px;
            background: rgba(255, 255, 255, 0.2);
        }

        .divider::before { left: 0; }
        .divider::after { right: 0; }

        .container {
            max-width: 1600px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            background: rgba(255, 255, 255, 0.05);
            padding: 0.5rem;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            background: transparent;
            border: none;
            padding: 1rem;
            font-size: 1.1rem;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s;
            font-weight: 600;
            color: #b8b8d1;
            min-width: 150px;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.02);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .studio {
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            gap: 1.5rem;
            background: rgba(255, 255, 255, 0.03);
            padding: 1.5rem;
            border-radius: 20px;
            min-height: 80vh;
        }

        .toolbar {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
            max-height: 85vh;
            overflow-y: auto;
        }

        .toolbar h3 {
            margin-bottom: 1.5rem;
            color: #667eea;
            font-size: 1.2rem;
        }

        .tool-section {
            margin-bottom: 2rem;
        }

        .tool-section h4 {
            font-size: 0.9rem;
            color: #b8b8d1;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .tool-btn {
            width: 100%;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid transparent;
            padding: 0.8rem;
            margin: 0.5rem 0;
            border-radius: 10px;
            cursor: pointer;
            color: white;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tool-btn:hover {
            background: rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }

        .tool-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #764ba2;
        }

        .canvas-area {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .canvas-controls {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 15px;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        #artCanvas {
            width: 100%;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            cursor: crosshair;
        }

        .properties {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
            max-height: 85vh;
            overflow-y: auto;
        }

        .properties h3 {
            margin-bottom: 1.5rem;
            color: #667eea;
        }

        .property-item {
            margin-bottom: 1.5rem;
        }

        .property-item label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: #b8b8d1;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            cursor: pointer;
        }

        input[type="color"] {
            width: 100%;
            height: 50px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }

        .color-palette {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .color-swatch {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .color-swatch:hover {
            transform: scale(1.1);
            border-color: white;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 2rem;
        }

        .art-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            overflow: hidden;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .art-card.hidden {
            opacity: 0.3;
        }

        .art-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3);
        }

        .art-card img {
            width: 100%;
            height: 300px;
            object-fit: cover;
        }

        .art-info {
            padding: 1.5rem;
        }

        .art-info h3 {
            margin-bottom: 0.5rem;
            font-size: 1.3rem;
        }

        .art-info p {
            color: #b8b8d1;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .art-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            color: #888;
            font-size: 0.9rem;
        }

        .vote-section {
            display: flex;
            gap: 1rem;
        }

        .vote-btn {
            flex: 1;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.1);
            padding: 0.6rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 1.1rem;
            color: white;
        }

        .vote-btn:hover {
            transform: scale(1.05);
        }

        .vote-btn.upvoted {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            border-color: #38ef7d;
        }

        .vote-btn.downvoted {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
            border-color: #f45c43;
        }

        .upload-area {
            border: 3px dashed rgba(102, 126, 234, 0.5);
            border-radius: 15px;
            padding: 3rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.03);
        }

        .upload-area:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .upload-area.dragover {
            border-color: #38ef7d;
            background: rgba(56, 239, 125, 0.1);
        }

        #previewImage {
            max-width: 100%;
            max-height: 400px;
            border-radius: 15px;
            margin-top: 1rem;
        }

        .error, .success {
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            text-align: center;
        }

        .error {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #f44336;
        }

        .success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid #4caf50;
        }

        .cooldown {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid #ffc107;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            text-align: center;
        }

        .admin-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 2rem;
            backdrop-filter: blur(10px);
        }

        .admin-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .admin-card {
            background: rgba(255, 255, 255, 0.08);
            padding: 1.5rem;
            border-radius: 12px;
            border: 2px solid rgba(102, 126, 234, 0.3);
        }

        .admin-card h4 {
            color: #667eea;
            margin-bottom: 1rem;
        }

        .admin-art-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .admin-art-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .admin-art-card img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
        }

        .admin-art-info {
            flex: 1;
        }

        .admin-art-info h5 {
            margin-bottom: 0.3rem;
        }

        .admin-art-info p {
            color: #888;
            font-size: 0.9rem;
        }

        .admin-actions {
            display: flex;
            gap: 0.5rem;
            flex-direction: column;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.08);
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            margin: 0.3rem;
            transition: all 0.3s;
        }

        .filter-btn:hover {
            background: rgba(102, 126, 234, 0.3);
        }

        .banned-user {
            background: rgba(255, 255, 255, 0.05);
            padding: 0.8rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        @media (max-width: 1200px) {
            .studio {
                grid-template-columns: 1fr;
            }

            .toolbar, .properties {
                max-height: none;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">üé® Grupo Armindo Art Museum</div>
        <div class="user-info">
            <div id="userSection"></div>
        </div>
    </div>

    <div id="loginModal" class="modal active">
        <div class="modal-content">
            <h2>üé® Bem-vindo</h2>
            <button class="google-btn" onclick="loginWithGoogle()">
                <svg width="20" height="20" viewBox="0 0 20 20">
                    <path fill="#4285F4" d="M19.6 10.23c0-.82-.1-1.42-.25-2.05H10v3.72h5.5c-.15.96-.74 2.31-2.04 3.22v2.45h3.16c1.89-1.73 2.98-4.3 2.98-7.34z"/>
                    <path fill="#34A853" d="M13.46 15.13c-.83.59-1.96 1-3.46 1-2.64 0-4.88-1.74-5.68-4.15H1.07v2.52C2.72 17.75 6.09 20 10 20c2.7 0 4.96-.89 6.62-2.42l-3.16-2.45z"/>
                    <path fill="#FBBC05" d="M3.99 10c0-.69.12-1.35.32-1.97V5.51H1.07A9.973 9.973 0 000 10c0 1.61.39 3.14 1.07 4.49l3.24-2.52c-.2-.62-.32-1.28-.32-1.97z"/>
                    <path fill="#EA4335" d="M10 3.88c1.88 0 3.13.81 3.85 1.48l2.84-2.76C14.96.99 12.7 0 10 0 6.09 0 2.72 2.25 1.07 5.51l3.24 2.52C5.12 5.62 7.36 3.88 10 3.88z"/>
                </svg>
                Continuar com Google
            </button>
            
            <div class="divider">ou</div>
            
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="loginEmail" placeholder="seu@email.com">
            </div>
            <div class="form-group">
                <label>Senha</label>
                <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <button class="btn" onclick="loginWithEmail()" style="width: 100%; margin-bottom: 0.5rem;">Entrar</button>
            <button class="btn btn-secondary" onclick="toggleRegister()" style="width: 100%;">Criar Conta</button>
            <div id="loginMessage"></div>
        </div>
    </div>

    <div id="registerModal" class="modal">
        <div class="modal-content">
            <h2>‚ú® Criar Conta</h2>
            <div class="form-group">
                <label>Nome de Artista</label>
                <input type="text" id="regUsername" placeholder="Seu nome">
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="regEmail" placeholder="seu@email.com">
            </div>
            <div class="form-group">
                <label>Senha</label>
                <input type="password" id="regPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <button class="btn" onclick="registerUser()" style="width: 100%; margin-bottom: 0.5rem;">Criar Conta</button>
            <button class="btn btn-secondary" onclick="toggleRegister()" style="width: 100%;">Voltar ao Login</button>
            <div id="registerMessage"></div>
        </div>
    </div>

    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('draw')">üé® Criar Arte</button>
            <button class="tab" onclick="switchTab('upload')">üì§ Upload</button>
            <button class="tab" onclick="switchTab('gallery')">üñºÔ∏è Galeria</button>
            <button class="tab" id="adminTab" onclick="switchTab('admin')" style="display: none;">üõ°Ô∏è Admin</button>
        </div>

        <div id="drawSection" class="section active">
            <div id="drawCooldown" class="cooldown" style="display: none;"></div>
            <div class="studio">
                <div class="toolbar">
                    <h3>üõ†Ô∏è Ferramentas</h3>
                    
                    <div class="tool-section">
                        <h4>Desenho</h4>
                        <button class="tool-btn active" onclick="setTool('brush')">üñåÔ∏è Pincel</button>
                        <button class="tool-btn" onclick="setTool('eraser')">üßπ Borracha</button>
                        <button class="tool-btn" onclick="setTool('spray')">üí® Spray</button>
                    </div>
                </div>

                <div class="canvas-area">
                    <div class="canvas-controls">
                        <button class="btn btn-secondary" onclick="clearCanvas()">üóëÔ∏è Limpar</button>
                        <button class="btn btn-secondary" onclick="undo()">‚Ü∂ Desfazer</button>
                        <button class="btn btn-secondary" onclick="redo()">‚Ü∑ Refazer</button>
                        <button class="btn btn-secondary" onclick="downloadCanvas()">üíæ Baixar</button>
                        <button class="btn" onclick="saveArtwork()">‚ú® Publicar Arte</button>
                    </div>
                    <canvas id="artCanvas" width="1200" height="800"></canvas>
                </div>

                <div class="properties">
                    <h3>‚öôÔ∏è Propriedades</h3>
                    
                    <div class="property-item">
                        <label>Cor Principal</label>
                        <input type="color" id="mainColor" value="#667eea">
                        <div class="color-palette">
                            <div class="color-swatch" style="background: #667eea" onclick="setColor('#667eea')"></div>
                            <div class="color-swatch" style="background: #764ba2" onclick="setColor('#764ba2')"></div>
                            <div class="color-swatch" style="background: #f093fb" onclick="setColor('#f093fb')"></div>
                            <div class="color-swatch" style="background: #43e97b" onclick="setColor('#43e97b')"></div>
                            <div class="color-swatch" style="background: #000000" onclick="setColor('#000000')"></div>
                        </div>
                    </div>

                    <div class="property-item">
                        <label>Espessura: <span id="sizeDisplay">10</span>px</label>
                        <input type="range" id="brushSize" min="1" max="100" value="10" oninput="updateSize()">
                    </div>

                    <div class="property-item">
                        <label>Opacidade: <span id="opacityDisplay">100</span>%</label>
                        <input type="range" id="opacity" min="0" max="100" value="100" oninput="updateOpacity()">
                    </div>

                    <div class="property-item">
                        <h4 style="margin-bottom: 0.5rem; color: #b8b8d1;">Filtros R√°pidos</h4>
                        <button class="filter-btn" onclick="applyFilter('grayscale')">‚ö™ Preto e Branco</button>
                        <button class="filter-btn" onclick="applyFilter('sepia')">üü§ S√©pia</button>
                        <button class="filter-btn" onclick="applyFilter('invert')">üîÑ Inverter</button>
                    </div>

                    <div class="form-group">
                        <label>Nome da Obra</label>
                        <input type="text" id="artworkName" maxlength="50">
                    </div>

                    <div class="form-group">
                        <label>Descri√ß√£o</label>
                        <textarea id="artworkDesc" maxlength="200" rows="3"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <div id="uploadSection" class="section">
            <div id="uploadCooldown" class="cooldown" style="display: none;"></div>
            <div style="max-width: 800px; margin: 0 auto;">
                <div class="upload-area" id="dropZone" onclick="document.getElementById('fileInput').click()">
                    <h2>üì§ Arraste uma imagem ou clique para fazer upload</h2>
                    <p style="color: #b8b8d1; margin-top: 1rem;">Formatos aceitos: JPG, PNG, GIF (m√°x. 5MB)</p>
                    <input type="file" id="fileInput" accept="image/*" style="display: none;">
                </div>
                <img id="previewImage" style="display: none;">
                
                <div class="form-group" style="margin-top: 2rem;">
                    <label>Nome da Obra</label>
                    <input type="text" id="uploadArtworkName" maxlength="50">
                </div>

                <div class="form-group">
                    <label>Descri√ß√£o</label>
                    <textarea id="uploadArtworkDesc" maxlength="200" rows="3"></textarea>
                </div>

                <button class="btn" onclick="uploadArtwork()" style="width: 100%; margin-top: 1rem;">‚ú® Publicar Upload</button>
                <div id="uploadMessage"></div>
            </div>
        </div>

        <div id="gallerySection" class="section">
            <div id="galleryContent" class="gallery-grid"></div>
        </div>

        <div id="adminSection" class="section">
            <div class="admin-panel">
                <h2 style="margin-bottom: 2rem; color: #667eea;">üõ°Ô∏è Painel de Administra√ß√£o</h2>
                
                <div class="admin-controls">
                    <div class="admin-card">
                        <h4>‚è±Ô∏è Cooldown Global</h4>
                        <div class="form-group">
                            <label>Horas entre publica√ß√µes</label>
                            <input type="number" id="cooldownHours" value="2" min="0" max="24">
                        </div>
                        <button class="btn" onclick="updateCooldown()">Atualizar Cooldown</button>
                    </div>

                    <div class="admin-card">
                        <h4>üë• Usu√°rios Banidos</h4>
                        <div id="bannedList" style="max-height: 200px; overflow-y: auto; margin-bottom: 1rem;">
                            <p style="color: #888;">Nenhum usu√°rio banido</p>
                        </div>
                    </div>

                    <div class="admin-card">
                        <h4>üìä Estat√≠sticas</h4>
                        <p style="color: #b8b8d1;">Total de obras: <span id="totalArts">0</span></p>
                        <p style="color: #b8b8d1;">Obras ocultas: <span id="hiddenArts">0</span></p>
                        <p style="color: #b8b8d1;">Usu√°rios ativos: <span id="activeUsers">0</span></p>
                    </div>
                </div>

                <div class="admin-card">
                    <h4>üñºÔ∏è Gerenciar Obras</h4>
                    <div id="adminArtsList" class="admin-art-list"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithPopup, GoogleAuthProvider, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getDatabase, ref, push, onValue, update, get, remove, set } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // CONFIGURE SEU FIREBASE AQUI
        const firebaseConfig = {
  apiKey: "AIzaSyA8azNy6GEgD190y_fW91ahUbKa1w5veik",
  authDomain: "aawards.firebaseapp.com",
  databaseURL: "https://aawards-default-rtdb.firebaseio.com",
  projectId: "aawards",
  storageBucket: "aawards.firebasestorage.app",
  messagingSenderId: "839334918366",
  appId: "1:839334918366:web:454a259fa3e2665b46ea4f",
  measurementId: "G-NLLMB9THVX"
};

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        const provider = new GoogleAuthProvider();

        window.db = db;
        window.auth = auth;

        let currentUser = null;
        const ADMIN_EMAILS = ['rafaelcarvalhodiogo@gmail.com'];

        // Canvas setup
        const canvas = document.getElementById('artCanvas');
        const ctx = canvas.getContext('2d');
        let drawing = false;
        let currentTool = 'brush';
        let history = [];
        let historyStep = -1;
        let startX, startY;

        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        saveHistory();

        canvas.addEventListener('mousedown', startDraw);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDraw);
        canvas.addEventListener('mouseout', stopDraw);

        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            startDraw({clientX: touch.clientX, clientY: touch.clientY});
        });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            draw({clientX: touch.clientX, clientY: touch.clientY});
        });

        canvas.addEventListener('touchend', stopDraw);

        function startDraw(e) {
            drawing = true;
            const rect = canvas.getBoundingClientRect();
            startX = e.clientX - rect.left;
            startY = e.clientY - rect.top;
            
            if (currentTool === 'brush' || currentTool === 'eraser') {
                ctx.beginPath();
                ctx.moveTo(startX, startY);
            }
        }

        function draw(e) {
            if (!drawing) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            const color = document.getElementById('mainColor').value;
            const size = document.getElementById('brushSize').value;
            const opacity = document.getElementById('opacity').value / 100;

            ctx.globalAlpha = opacity;
            ctx.strokeStyle = currentTool === 'eraser' ? '#ffffff' : color;
            ctx.fillStyle = color;
            ctx.lineWidth = size;

            if (currentTool === 'brush') {
                ctx.lineTo(x, y);
                ctx.stroke();
            } else if (currentTool === 'eraser') {
                ctx.lineTo(x, y);
                ctx.stroke();
            } else if (currentTool === 'spray') {
                for (let i = 0; i < 10; i++) {
                    const offsetX = (Math.random() - 0.5) * size;
                    const offsetY = (Math.random() - 0.5) * size;
                    ctx.fillRect(x + offsetX, y + offsetY, 2, 2);
                }
            }
        }

        function stopDraw() {
            if (!drawing) return;
            drawing = false;
            saveHistory();
        }

        function saveHistory() {
            historyStep++;
            if (historyStep < history.length) {
                history.length = historyStep;
            }
            history.push(canvas.toDataURL());
        }

        window.setTool = function(tool) {
            currentTool = tool;
            document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        window.setColor = function(color) {
            document.getElementById('mainColor').value = color;
        }

        window.updateSize = function() {
            document.getElementById('sizeDisplay').textContent = document.getElementById('brushSize').value;
        }

        window.updateOpacity = function() {
            document.getElementById('opacityDisplay').textContent = document.getElementById('opacity').value;
        }

        window.undo = function() {
            if (historyStep > 0) {
                historyStep--;
                const img = new Image();
                img.src = history[historyStep];
                img.onload = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0);
                };
            }
        }

        window.redo = function() {
            if (historyStep < history.length - 1) {
                historyStep++;
                const img = new Image();
                img.src = history[historyStep];
                img.onload = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0);
                };
            }
        }

        window.clearCanvas = function() {
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            saveHistory();
        }

        window.applyFilter = function(filter) {
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            for (let i = 0; i < data.length; i += 4) {
                if (filter === 'grayscale') {
                    const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                    data[i] = data[i + 1] = data[i + 2] = avg;
                } else if (filter === 'sepia') {
                    const r = data[i], g = data[i + 1], b = data[i + 2];
                    data[i] = Math.min(255, r * 0.393 + g * 0.769 + b * 0.189);
                    data[i + 1] = Math.min(255, r * 0.349 + g * 0.686 + b * 0.168);
                    data[i + 2] = Math.min(255, r * 0.272 + g * 0.534 + b * 0.131);
                } else if (filter === 'invert') {
                    data[i] = 255 - data[i];
                    data[i + 1] = 255 - data[i + 1];
                    data[i + 2] = 255 - data[i + 2];
                }
            }

            ctx.putImageData(imageData, 0, 0);
            saveHistory();
        }

        window.downloadCanvas = function() {
            const link = document.createElement('a');
            link.download = 'minha-arte.png';
            link.href = canvas.toDataURL();
            link.click();
        }

        // Authentication
        window.loginWithGoogle = async function() {
            try {
                const result = await signInWithPopup(auth, provider);
                currentUser = result.user;
                closeModals();
                updateUserSection();
            } catch (error) {
                document.getElementById('loginMessage').innerHTML = `<div class="error">${error.message}</div>`;
            }
        }

        window.loginWithEmail = async function() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const msg = document.getElementById('loginMessage');

            if (!email || !password) {
                msg.innerHTML = '<div class="error">Preencha todos os campos</div>';
                return;
            }

            try {
                const result = await signInWithEmailAndPassword(auth, email, password);
                currentUser = result.user;
                closeModals();
                updateUserSection();
            } catch (error) {
                msg.innerHTML = '<div class="error">Email ou senha incorretos</div>';
            }
        }

        window.registerUser = async function() {
            const username = document.getElementById('regUsername').value.trim();
            const email = document.getElementById('regEmail').value.trim();
            const password = document.getElementById('regPassword').value;
            const msg = document.getElementById('registerMessage');

            if (!username || !email || !password) {
                msg.innerHTML = '<div class="error">Preencha todos os campos</div>';
                return;
            }

            if (password.length < 6) {
                msg.innerHTML = '<div class="error">A senha deve ter pelo menos 6 caracteres</div>';
                return;
            }

            try {
                const result = await createUserWithEmailAndPassword(auth, email, password);
                await set(ref(db, 'users/' + result.user.uid), {
                    username,
                    email,
                    createdAt: Date.now()
                });
                currentUser = result.user;
                closeModals();
                updateUserSection();
            } catch (error) {
                msg.innerHTML = `<div class="error">${error.message}</div>`;
            }
        }

        window.toggleRegister = function() {
            document.getElementById('loginModal').classList.toggle('active');
            document.getElementById('registerModal').classList.toggle('active');
        }

        function closeModals() {
            document.getElementById('loginModal').classList.remove('active');
            document.getElementById('registerModal').classList.remove('active');
        }

        async function updateUserSection() {
            if (!currentUser) return;

            const userDataSnap = await get(ref(db, 'users/' + currentUser.uid));
            const userData = userDataSnap.val() || {};
            const username = userData.username || currentUser.displayName || currentUser.email.split('@')[0];
            const photo = currentUser.photoURL;

            let avatarHTML = '';
            if (photo) {
                avatarHTML = `<img src="${photo}" class="user-photo" alt="${username}">`;
            } else {
                avatarHTML = `<div class="user-avatar">${username[0].toUpperCase()}</div>`;
            }

            document.getElementById('userSection').innerHTML = `
                ${avatarHTML}
                <span>${username}</span>
                <button class="btn btn-outline" onclick="logout()">Sair</button>
            `;

            if (ADMIN_EMAILS.includes(currentUser.email)) {
                document.getElementById('adminTab').style.display = 'block';
            }
        }

        window.logout = function() {
            auth.signOut();
            location.reload();
        }

        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            if (user) {
                closeModals();
                updateUserSection();
                loadGallery();
            } else {
                document.getElementById('loginModal').classList.add('active');
            }
        });

        // Artwork functions
        window.saveArtwork = async function() {
            if (!currentUser) {
                alert('Fa√ßa login para publicar');
                return;
            }

            const name = document.getElementById('artworkName').value.trim();
            const desc = document.getElementById('artworkDesc').value.trim();

            if (!name || !desc) {
                alert('Preencha nome e descri√ß√£o');
                return;
            }

            await publishToGallery(canvas.toDataURL(), name, desc);
        }

        window.uploadArtwork = async function() {
            if (!currentUser) {
                alert('Fa√ßa login para publicar');
                return;
            }

            const preview = document.getElementById('previewImage');
            const name = document.getElementById('uploadArtworkName').value.trim();
            const desc = document.getElementById('uploadArtworkDesc').value.trim();

            if (!preview.src || !name || !desc) {
                document.getElementById('uploadMessage').innerHTML = '<div class="error">Carregue uma imagem e preencha todos os campos</div>';
                return;
            }

            await publishToGallery(preview.src, name, desc);
        }

        async function publishToGallery(imageData, name, desc) {
            try {
                const cooldownSnap = await get(ref(db, 'settings/cooldown'));
                const cooldownHours = cooldownSnap.val() || 2;
                const cooldownMs = cooldownHours * 60 * 60 * 1000;

                const userPostsRef = ref(db, `userPosts/${currentUser.uid}`);
                const userPostsSnap = await get(userPostsRef);
                const lastPost = userPostsSnap.val()?.lastPostTime || 0;
                const now = Date.now();

                if (now - lastPost < cooldownMs) {
                    const remaining = cooldownMs - (now - lastPost);
                    const hours = Math.floor(remaining / (60 * 60 * 1000));
                    const minutes = Math.floor((remaining % (60 * 60 * 1000)) / (60 * 1000));
                    alert(`Aguarde ${hours}h ${minutes}m para publicar novamente`);
                    return;
                }

                const bannedSnap = await get(ref(db, 'banned/' + currentUser.uid));
                if (bannedSnap.exists()) {
                    alert('Voc√™ foi banido e n√£o pode publicar');
                    return;
                }

                const userDataSnap = await get(ref(db, 'users/' + currentUser.uid));
                const userData = userDataSnap.val() || {};
                const username = userData.username || currentUser.displayName || currentUser.email.split('@')[0];

                const artwork = {
                    name,
                    description: desc,
                    image: imageData,
                    artist: username,
                    artistId: currentUser.uid,
                    timestamp: now,
                    votes: 0,
                    voters: {},
                    hidden: false
                };

                await push(ref(db, 'artworks'), artwork);
                await set(userPostsRef, { lastPostTime: now });
                
                alert('‚úì Arte publicada com sucesso!');
                
                document.getElementById('artworkName').value = '';
                document.getElementById('artworkDesc').value = '';
                document.getElementById('uploadArtworkName').value = '';
                document.getElementById('uploadArtworkDesc').value = '';
                document.getElementById('previewImage').style.display = 'none';
                
                clearCanvas();
                switchTab('gallery');
            } catch (error) {
                alert('Erro ao publicar. Verifique a configura√ß√£o do Firebase.');
                console.error(error);
            }
        }

        // File upload
        document.getElementById('fileInput').addEventListener('change', handleFileSelect);

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (!file) return;

            if (file.size > 5 * 1024 * 1024) {
                alert('Arquivo muito grande. M√°ximo 5MB');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(event) {
                const preview = document.getElementById('previewImage');
                preview.src = event.target.result;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }

        const dropZone = document.getElementById('dropZone');
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                document.getElementById('fileInput').files = e.dataTransfer.files;
                handleFileSelect({ target: { files: [file] } });
            }
        });

        // Tab switching
        window.switchTab = function(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));

            if (tab === 'draw') {
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.getElementById('drawSection').classList.add('active');
                checkCooldown('draw');
            } else if (tab === 'upload') {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('uploadSection').classList.add('active');
                checkCooldown('upload');
            } else if (tab === 'gallery') {
                document.querySelectorAll('.tab')[2].classList.add('active');
                document.getElementById('gallerySection').classList.add('active');
                loadGallery();
            } else if (tab === 'admin') {
                document.querySelectorAll('.tab')[3].classList.add('active');
                document.getElementById('adminSection').classList.add('active');
                loadAdmin();
            }
        }

        async function checkCooldown(type) {
            if (!currentUser) return;

            try {
                const cooldownSnap = await get(ref(db, 'settings/cooldown'));
                const cooldownHours = cooldownSnap.val() || 2;
                const cooldownMs = cooldownHours * 60 * 60 * 1000;

                const userPostsSnap = await get(ref(db, `userPosts/${currentUser.uid}`));
                const lastPost = userPostsSnap.val()?.lastPostTime || 0;
                const cooldownDiv = document.getElementById(type + 'Cooldown');

                const now = Date.now();
                const remaining = cooldownMs - (now - lastPost);

                if (remaining > 0) {
                    const hours = Math.floor(remaining / (60 * 60 * 1000));
                    const minutes = Math.floor((remaining % (60 * 60 * 1000)) / (60 * 1000));
                    cooldownDiv.textContent = `‚è±Ô∏è Pr√≥xima publica√ß√£o em: ${hours}h ${minutes}m`;
                    cooldownDiv.style.display = 'block';
                    setTimeout(() => checkCooldown(type), 60000);
                } else {
                    cooldownDiv.style.display = 'none';
                }
            } catch (error) {
                console.error('Erro ao verificar cooldown:', error);
            }
        }

        // Gallery
        async function loadGallery() {
            const gallery = document.getElementById('galleryContent');
            gallery.innerHTML = '<div style="text-align: center; padding: 3rem; color: #b8b8d1;">Carregando galeria...</div>';

            try {
                onValue(ref(db, 'artworks'), (snapshot) => {
                    const artworks = [];
                    snapshot.forEach(child => {
                        const art = { id: child.key, ...child.val() };
                        if (!art.hidden || (currentUser && ADMIN_EMAILS.includes(currentUser.email))) {
                            artworks.push(art);
                        }
                    });

                    artworks.sort((a, b) => b.timestamp - a.timestamp);

                    if (artworks.length === 0) {
                        gallery.innerHTML = '<div style="text-align: center; padding: 3rem; color: #b8b8d1;">Nenhuma obra ainda. Seja o primeiro!</div>';
                        return;
                    }

                    gallery.innerHTML = artworks.map(art => `
                        <div class="art-card ${art.hidden ? 'hidden' : ''}">
                            <img src="${art.image}" alt="${escapeHtml(art.name)}">
                            <div class="art-info">
                                <h3>${escapeHtml(art.name)} ${art.hidden ? 'üîí' : ''}</h3>
                                <p>${escapeHtml(art.description)}</p>
                                <div class="art-meta">
                                    <span>üë®‚Äçüé® ${escapeHtml(art.artist || 'Artista')}</span>
                                    <span>${new Date(art.timestamp).toLocaleDateString('pt-PT')}</span>
                                </div>
                                <div class="vote-section">
                                    <button class="vote-btn ${hasVoted(art.id, art.voters, 1) ? 'upvoted' : ''}" 
                                            onclick="vote('${art.id}', 1)">
                                        üëç ${getVoteCount(art.voters, 1)}
                                    </button>
                                    <button class="vote-btn ${hasVoted(art.id, art.voters, -1) ? 'downvoted' : ''}" 
                                            onclick="vote('${art.id}', -1)">
                                        üëé ${getVoteCount(art.voters, -1)}
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                });
            } catch (error) {
                gallery.innerHTML = '<div class="error">Erro ao carregar. Configure o Firebase corretamente.</div>';
            }
        }

        window.vote = async function(artId, value) {
            if (!currentUser) {
                alert('Fa√ßa login para votar');
                return;
            }

            const artRef = ref(db, `artworks/${artId}`);

            try {
                const snapshot = await get(artRef);
                const art = snapshot.val();
                const voters = art.voters || {};
                const currentVote = voters[currentUser.uid];

                let newVotes = art.votes || 0;

                if (currentVote === value) {
                    delete voters[currentUser.uid];
                    newVotes -= value;
                } else {
                    if (currentVote) newVotes -= currentVote;
                    voters[currentUser.uid] = value;
                    newVotes += value;
                }

                await update(artRef, { votes: newVotes, voters });
            } catch (error) {
                console.error('Erro ao votar:', error);
            }
        }

        function hasVoted(artId, voters, value) {
            if (!voters || !currentUser) return false;
            return voters[currentUser.uid] === value;
        }

        function getVoteCount(voters, value) {
            if (!voters) return 0;
            return Object.values(voters).filter(v => v === value).length;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Admin functions
        async function loadAdmin() {
            try {
                const cooldownSnap = await get(ref(db, 'settings/cooldown'));
                document.getElementById('cooldownHours').value = cooldownSnap.val() || 2;

                await loadBannedUsers();
                await loadAdminArts();
                await loadStats();
            } catch (error) {
                console.error('Erro ao carregar admin:', error);
            }
        }

        async function loadBannedUsers() {
            const bannedSnap = await get(ref(db, 'banned'));
            const bannedDiv = document.getElementById('bannedList');

            if (!bannedSnap.exists()) {
                bannedDiv.innerHTML = '<p style="color: #888;">Nenhum usu√°rio banido</p>';
                return;
            }

            const banned = [];
            bannedSnap.forEach(child => {
                banned.push({ uid: child.key, ...child.val() });
            });

            bannedDiv.innerHTML = banned.map(b => `
                <div class="banned-user">
                    <span>${escapeHtml(b.email || 'Usu√°rio')}</span>
                    <button class="btn btn-small" onclick="unbanUser('${b.uid}')">Desbanir</button>
                </div>
            `).join('');
        }

        async function loadAdminArts() {
            const artsSnap = await get(ref(db, 'artworks'));
            const artsList = document.getElementById('adminArtsList');

            if (!artsSnap.exists()) {
                artsList.innerHTML = '<p style="color: #888;">Nenhuma obra</p>';
                return;
            }

            const artworks = [];
            artsSnap.forEach(child => {
                artworks.push({ id: child.key, ...child.val() });
            });

            artworks.sort((a, b) => b.timestamp - a.timestamp);

            artsList.innerHTML = artworks.map(art => `
                <div class="admin-art-card">
                    <img src="${art.image}" alt="${escapeHtml(art.name)}">
                    <div class="admin-art-info">
                        <h5>${escapeHtml(art.name)} ${art.hidden ? 'üîí' : ''}</h5>
                        <p>Por: ${escapeHtml(art.artist)}</p>
                        <p>${new Date(art.timestamp).toLocaleDateString('pt-PT')}</p>
                    </div>
                    <div class="admin-actions">
                        <button class="btn btn-small btn-secondary" onclick="toggleHideArt('${art.id}', ${!art.hidden})">
                            ${art.hidden ? 'üëÅÔ∏è Mostrar' : 'üîí Ocultar'}
                        </button>
                        <button class="btn btn-small" onclick="banArtist('${art.artistId}')">
                            üö´ Banir Artista
                        </button>
                        <button class="btn btn-small btn-danger" onclick="deleteArt('${art.id}')">
                            üóëÔ∏è Excluir
                        </button>
                    </div>
                </div>
            `).join('');
        }

        async function loadStats() {
            const artsSnap = await get(ref(db, 'artworks'));
            const usersSnap = await get(ref(db, 'users'));

            let total = 0;
            let hidden = 0;
            const artists = new Set();

            if (artsSnap.exists()) {
                artsSnap.forEach(child => {
                    total++;
                    const art = child.val();
                    if (art.hidden) hidden++;
                    if (art.artistId) artists.add(art.artistId);
                });
            }

            document.getElementById('totalArts').textContent = total;
            document.getElementById('hiddenArts').textContent = hidden;
            document.getElementById('activeUsers').textContent = artists.size;
        }

        window.updateCooldown = async function() {
            try {
                const hours = document.getElementById('cooldownHours').value;
                await set(ref(db, 'settings/cooldown'), parseInt(hours));
                alert('‚úì Cooldown atualizado!');
            } catch (error) {
                alert('Erro ao atualizar cooldown');
                console.error(error);
            }
        }

        window.toggleHideArt = async function(artId, hide) {
            try {
                await update(ref(db, `artworks/${artId}`), { hidden: hide });
                loadAdminArts();
                loadStats();
            } catch (error) {
                console.error('Erro ao ocultar/mostrar arte:', error);
            }
        }

        window.deleteArt = async function(artId) {
            if (!confirm('Tem certeza que deseja excluir esta obra?')) return;
            
            try {
                await remove(ref(db, `artworks/${artId}`));
                loadAdminArts();
                loadStats();
            } catch (error) {
                console.error('Erro ao excluir arte:', error);
            }
        }

        window.banArtist = async function(artistId) {
            if (!confirm('Tem certeza que deseja banir este artista?')) return;
            
            try {
                const userSnap = await get(ref(db, `users/${artistId}`));
                const user = userSnap.val();
                
                await set(ref(db, `banned/${artistId}`), {
                    email: user?.email || 'Desconhecido',
                    bannedAt: Date.now()
                });
                
                alert('‚úì Artista banido!');
                loadBannedUsers();
            } catch (error) {
                console.error('Erro ao banir artista:', error);
            }
        }

        window.unbanUser = async function(uid) {
            try {
                await remove(ref(db, `banned/${uid}`));
                alert('‚úì Usu√°rio desbanido!');
                loadBannedUsers();
            } catch (error) {
                console.error('Erro ao desbanir:', error);
            }
        }

        // Inicializar cooldown padr√£o se n√£o existir
        async function initSettings() {
            try {
                const cooldownSnap = await get(ref(db, 'settings/cooldown'));
                if (!cooldownSnap.exists()) {
                    await set(ref(db, 'settings/cooldown'), 2);
                }
            } catch (error) {
                console.error('Erro ao inicializar configura√ß√µes:', error);
            }
        }

        initSettings();
    </script>
</body>
</html>